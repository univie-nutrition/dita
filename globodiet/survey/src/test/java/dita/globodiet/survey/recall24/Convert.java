package dita.globodiet.survey.recall24;

import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.assertEquals;

import org.apache.causeway.commons.collections.Can;
import org.apache.causeway.commons.internal.base._Strings;
import org.apache.causeway.commons.io.TextUtils;

class Convert {

    @Test
    void test() {
        String source = """
                RSP_NR;RSP_AL;RSP_DOB;RSP_SEX;RSP_IVC;IV_NR;IV_DAT;IV_DOW;IV_RDAT;IV_RDOW;IV_DUR;IV_SDIC;IV_SDIN;IV_SDAC;IV_SDAN;IV_RESH;IV_RESW;IV_RESE;IV_RESER;FCO_NR;FCO_C;FCO_HR;FCO_PC;FCO_TX;QLI_NR;QLI_TX;REC_NR;REC_T;REC_N;IG_NR;IG_NM;IG_G0;IG_G1;IG_G2;IG_FNR;IG_FAC;IG_DSC;IG_BRN;IG_TX;IG_RQI;IG_RQ;IG_QFU;IG_Q;IG_QU;NU_NR;NU_Q;NU_QU;NU_K;NU_TX;GCALZB;ZK;KDS;ZB;ZF;FC;FS;FP;FU;ZE;ZA;ZW;VA;VB1;VB2;VB3A;VB5;VB6;VB7;VB9G;VB12;VC;VD;VE;VK;MCA;MMG;MFE;MZN;F226;GCAL;GFPS;GKB;GJZB;GJ;GMKO;GP;F223;F222;F221;F220;F225;F224;F202;F201;F200;F205;F204;F203;F241;F240;F120;F100;F171;F170;F162;F161;F160;F164;F151;F150;F141;F140;F193;F183;F182;F181;F180;F184;F60;F40;F80;FCLA;FG;FM;FL;FK;FO3;FO6;FO9;FT;ECYS;EALA;EASP;EARG;EILE;EHIS;EH;EGLU;EGLY;EEA;ENA;EMET;ELEU;ELYS;EPHE;EPRO;EP;EVAL;ETHR;ETRP;ETYR;ESER;MCL;MCR;MCU;MF;MK;MJ;MNA;MMO;MMN;MP;MSE;MSI;MS;KDM;KDL;KD;KBC;KBH;KBN;KBL;KBP;KBW;KBU;KAM;KAS;KAX;KA;KER;KINST;KMF;KMD;KMG;KMT;KM;KPG;KPON;KPOR;KPS;KP;S_Carnitin;S_Chlorella;S_Chonroitinsulfat;S_Cholin;S_Coffein;S_Collagen;S_Cranberry;S_Curcuma;S_Baeckerhefe;S_Baldrian;S_Bierhefe;S_Bitterorange;S_Birkenblaetter;S_Blaubeere;S_Brennnessel;S_Bromelain;S_Brunnenkresse;S_Acerol;S_Ananas;S_Aronia;S_Artischoke;S_Augentrost;S_Isoflavone;S_Heidelbeere;S_Hirse;S_Holunderbeere;S_HyaluronS;S_Gelatine;S_Ginkgo;S_Ginseng;S_Glucomannan;S_GlucosaminHC;S_GlucosaminSF;S_Glutathion;S_Grapefruit;S_Granatapfel;S_Gruentee;S_Guarana;S_MSM;S_Mate;S_Meerrettich;S_Melissenblaetter;S_Melone;S_Mucopolysaccharide;S_Lavendeloel;S_Lecithin;S_Leinoel;S_Leinsamen;S_Karotte;S_Kieselerde;S_Knoblauch;S_Kreatin;S_Kuerbiskern;S_Kuerbiskernoel;S_Ringelblume;S_Rhodiola;S_Rotklee;S_Rotweintraube;S_Rutin;S_Passionsblume;S_Pflanzensterine;S_Petersilienkraut;S_Phosphatidylserin;S_PolyphenoleOhneIso;S_Pycnogenol;S_Olivenextrakt;S_Olivenoel;S_Nachtkerzenoel;S_Taurin;S_Teufelskralle;S_Traubenkern;S_Schachtelhalm;S_Schisandra;S_Sabale;S_Sanddorn;S_Salbei;S_Seefischoel;S_Spirulina;S_Soja;S_Wacholderbeere;S_Weinlaub;S_Weissdornbeere;S_Weizenkeimoel;S_Zitronensaft;S_betaGlucan;VB3;VAC;VAR;VEAT;VLUT;VLYC;VQ10;VZEA;ZO;ZM
                Respondent #;Resp.: Alias;Resp.: Date of Birth;Resp.: Sex (1=male,2=female);Resp.: Nr of Interviews;Interview #;Intv.: Date;Intv.: DayOfWeek (1=Mo..7=So);Intv. Recall: Date;Intv. Recall: DayOfWeek (1=Mo..7=So);Intv.: Duration[min];Intv.: Spec. Diet Code;Intv.: Spec. Diet Name;Intv.: Spec. Day Code;Intv.: Spec. Day Name;Intv.: Resp. Height[cm];Intv.: Resp. Quantifier[kg];Intv.: Resp. Energy Calc[kcal];Intv.: Resp. Energy Requirement[kcal];FCO # (Food Cons. Occasion);FCO: Code;FCO: Hour;FCO: Place Code;FCO: Text;QLI # (Quick List Item);QLI;Record #;Record: Type;Record: Name;Ingredient #;Ingr.: Name;Ingr.: Group;Ingr.: Subgroup 1;Ingr.: Subgroup 2;Ingr.: FoodNr;Ingr.: Facets;Ingr.: DietarySupplementCode;Ingr.: Brandname;Ingr.: Text;Ingr.: Raw Quant. with inedible Part;Ingr.: Raw Quant. w/o inedible Part;Ingr.: Quantification Unit;Ingr.: Quantity (Consumed);Ingr.: Quantity Unit;Nutrient #;Nut.: Quantity;Nut.: Quantity Unit;Nut.: Key;Nut.: Text;Nut.: Energie inkl. Ballaststoffen[kcal];Nut.: Kohlenhydrate[mg];Nut.: Saccharose (Rübenzucker)[mg];Nut.: Ballaststoffe[mg];Nut.: Fett[mg];Nut.: Cholesterin[mg];Nut.: Gesättigte Fettsäuren[mg];Nut.: Mehrfach ungesättigte Fettsäuren[mg];Nut.: Einfach ungesättigte Fettsäuren[mg];Nut.: Protein (Eiweiß)[mg];Nut.: Ethanol (Alkohol)[mg];Nut.: Wasser[mg];Nut.: Vitamin A Retinoläquivalent[µg];Nut.: Vitamin B1 Thiamin[µg];Nut.: Vitamin B2 Riboflavin[µg];Nut.: Vitamin B3 Niacinäquivalent[µg];Nut.: Vitamin B5 Pantothensäure[µg];Nut.: Vitamin B6 Pyridoxin[µg];Nut.: Vitamin B7 Biotin (Vitamin H)[µg];Nut.: Vitamin B9 gesamte Folsäure[µg];Nut.: Vitamin B12 Cobalamin[µg];Nut.: Vitamin C Ascorbinsäure[µg];Nut.: Vitamin D Calciferole[µg];Nut.: Vitamin E Alpha-Tocopheroläquivalent[µg];Nut.: Vitamin K Phyllochinon[µg];Nut.: Calcium[mg];Nut.: Magnesium[mg];Nut.: Eisen[µg];Nut.: Zink[µg];Nut.: Docosahexaensäure[mg];Nut.: Energie exkl. Ballaststoffen[kcal];Nut.: P/S Verhältnis[‍‍];Nut.: Broteinheiten BE[‍BE];Nut.: Energie inkl. Ballaststoffen[kJ];Nut.: Energie exkl. Ballaststoffen[kJ];Nut.: Gesamt-Kochsalz[mg];Nut.: Mittlere Portionsgröße[‍g];Nut.: Docosatriensäure[mg];Nut.: Docosadiensäure[mg];Nut.: Decosensäure/Erucasäure[mg];Nut.: Decosansäure/Behensäure[mg];Nut.: Docosapentaensäure[mg];Nut.: Docosatetraensäure[mg];Nut.: Eicosadiensäure[mg];Nut.: Eicosensäure[mg];Nut.: Eicosansäure/Arachinsäure[mg];Nut.: Eicosapentaensäure[mg];Nut.: Eicosatetraensäure/Arachidonsäure[mg];Nut.: Eicosatriensäure[mg];Nut.: Tetracosensäure/Nervonsäure[mg];Nut.: Tetracosansäure/Lignocerinsäure[mg];Nut.: Dodecansäure/Laurinsäure[mg];Nut.: Decansäure/Caprinsäure[mg];Nut.: Heptadecensäure[mg];Nut.: Heptadecansäure[mg];Nut.: Hexadecadiensäure[mg];Nut.: Hexadecensäure/Palmitoleinsäure[mg];Nut.: Hexadecansäure/Palmitinsäure[mg];Nut.: Hexadecatetraensäure[mg];Nut.: Pentadecensäure[mg];Nut.: Pentadecansäure[mg];Nut.: Tetradecensäure[mg];Nut.: Tetradecansäure/Myristinsäure[mg];Nut.: Nonadecatriensäure[mg];Nut.: Octadecatriensäure/Linolensäure[mg];Nut.: Octadecadiensäure/Linolsäure[mg];Nut.: Octadecensäure/Ölsäure[mg];Nut.: Octadecansäure/Stearinsäure[mg];Nut.: Octadecatetraensäure/Stearidonsäure[mg];Nut.: Hexansäure/Capronsäure[mg];Nut.: Butansäure/Buttersäure[mg];Nut.: Octansäure/Caprylsäure[mg];Nut.: Konjugierte Linolsäuren (CLA)[mg];Nut.: Glycerin und Lipoide[mg];Nut.: Mittelkettige Fettsäuren[mg];Nut.: Langkettige Fettsäuren[mg];Nut.: Kurzkettige Fettsäuren[mg];Nut.: Omega-3-Fettsäuren[mg];Nut.: Omega-6-Fettsäuren[mg];Nut.: Omega-9-Fettsäuren[mg];Nut.: trans fatty acids Transfettsäuren[mg];Nut.: Cystein[mg];Nut.: Alanin[mg];Nut.: Asparaginsäure[mg];Nut.: Arginin[mg];Nut.: Isoleucin[mg];Nut.: Histidin[mg];Nut.: Harnsäure[mg];Nut.: Glutaminsäure[mg];Nut.: Glycin[mg];Nut.: Essentielle Aminosäuren[mg];Nut.: Nichtessentielle Aminosäuren[mg];Nut.: Methionin[mg];Nut.: Leucin[mg];Nut.: Lysin[mg];Nut.: Phenylalanin[mg];Nut.: Prolin[mg];Nut.: Purin[mg];Nut.: Valin[mg];Nut.: Threonin[mg];Nut.: Tryptophan[mg];Nut.: Tyrosin[mg];Nut.: Serin[mg];Nut.: Chlorid[mg];Nut.: Chrom[µg];Nut.: Kupfer[µg];Nut.: Fluorid[µg];Nut.: Kalium[mg];Nut.: Iodid[µg];Nut.: Natrium[mg];Nut.: Molybdän[µg];Nut.: Mangan[µg];Nut.: Phosphor[mg];Nut.: Selen[µg];Nut.: Silicium[µg];Nut.: Schwefel[mg];Nut.: Maltose (Malzzucker)[mg];Nut.: Lactose (Milchzucker)[mg];Nut.: Disaccharide (2 M)[mg];Nut.: Cellulose[mg];Nut.: Poly-Hexosen[mg];Nut.: Wasserunlösliche Ballaststoffe[mg];Nut.: Lignin[mg];Nut.: Poly-Pentosen[mg];Nut.: Wasserlösliche Ballaststoffe[mg];Nut.: Poly-Uronsäure[mg];Nut.: Mannit[mg];Nut.: Sorbit[mg];Nut.: Xylit[mg];Nut.: Summe Zuckeralkohole[mg];Nut.: Erythritol[mg];Nut.: Inositol[mg];Nut.: Fructose (Fruchtzucker)[mg];Nut.: Zucker (gesamt)[mg];Nut.: Galactose (Schleimzucker)[mg];Nut.: Glucose (Traubenzucker)[mg];Nut.: Monosaccharide (1 M)[mg];Nut.: Glykogen (tierische Stärke)[mg];Nut.: Oligosaccaride, nicht resorbierbar[mg];Nut.: Oligosaccaride, resorbierbar (3 - 9 M)[mg];Nut.: Stärke[mg];Nut.: Polysaccharide (> 9 M)[mg];Nut.: L-Carnitin[mg];Nut.: Chlorella[mg];Nut.: Chondroitinsulfat[mg];Nut.: Cholin[mg];Nut.: Koffein[mg];Nut.: Kollagen[mg];Nut.: Cranberry Konzentrat, Extrakt, Pulver[mg];Nut.: Curcumaextrakt[mg];Nut.: Hefekonzentrat (Bäckerhefe)[mg];Nut.: Baldrianwurzel-Pulver[mg];Nut.: Bierhefe[mg];Nut.: Bitterorangenextrakt[mg];Nut.: Birkenblätterextrakt[mg];Nut.: Blaubeerextrakt[mg];Nut.: Brennnesselblätter Extrakt, Pulver[mg];Nut.: Bromelain[mg];Nut.: Brunnenkresse Extrakt[mg];Nut.: Acerolasaftpulver[mg];Nut.: Ananasextrakt[mg];Nut.: Aroniasaftpulver[mg];Nut.: Artischockenextrakt[mg];Nut.: Augentrostextrakt[mg];Nut.: Isoflavone[mg];Nut.: Heidelbeerextrakt[mg];Nut.: Hirse Extrakt, Hirsesamenextrakt[mg];Nut.: Holunderbeerenextrakt, Pulver[mg];Nut.: Hyaluronsäure[mg];Nut.: Gelatine-Hydrosylat[mg];Nut.: Ginkgo Biloba Extrakt, Ginkgoblätterextrakt[mg];Nut.: Ginseng Extrakt[mg];Nut.: Glucomannan[mg];Nut.: Glucosaminhydrochlorid[mg];Nut.: Glucosaminsulfat[mg];Nut.: Glutathion[mg];Nut.: Grapefruitextrakt[mg];Nut.: Granatapfelextrakt, Pulver[mg];Nut.: Grüner Tee Extrakt[mg];Nut.: Guaranaextrakt[mg];Nut.: Methylsulfonylmethan (MSM)[mg];Nut.: Mate Extrakt[mg];Nut.: Meerrettich Extrakt[mg];Nut.: Melissenextrakt, Melissenblätterextrakt[mg];Nut.: Melonenkonzentrat[mg];Nut.: Mucopolysaccharide[mg];Nut.: Lavendelöl[mg];Nut.: Lecithin[mg];Nut.: Leinöl[mg];Nut.: Leinsamenpulver[mg];Nut.: Karottenpulver[mg];Nut.: Kieselerde[mg];Nut.: Knoblauchextrakt[mg];Nut.: Kreatin[mg];Nut.: Kürbiskernextrakt, Pulver[mg];Nut.: Kürbiskernöl[mg];Nut.: Ringelblumenextrakt[mg];Nut.: Rhodiola Rosea Extrakt[mg];Nut.: Rotkleeextrakt, Konzentrat, Pulver[mg];Nut.: Rotweintraubenextrakt[mg];Nut.: Rutin[mg];Nut.: Passionsblume[mg];Nut.: Pflanzensterine[mg];Nut.: Petersilienkrautpulver[mg];Nut.: Phosphatidylserin[mg];Nut.: Polyphenole (ohne Isoflavone)[mg];Nut.: Pycnogenol[mg];Nut.: Olivenextrakt[mg];Nut.: Olivenöl (nativ)[mg];Nut.: Nachtkerzenöl[mg];Nut.: Taurin[mg];Nut.: Teufelskrallenwurzelextrakt[mg];Nut.: Traubenkern-Extrakt[mg];Nut.: Schachtelhalmpulver[mg];Nut.: Schisandra Extrakt[mg];Nut.: Sabaleextrakt[mg];Nut.: Sanddornbeerensaftpulver[mg];Nut.: Salbeiextrakt, Salbeiblätterextrakt[mg];Nut.: Seefischöl[mg];Nut.: Spirulina[mg];Nut.: Sojabohnenkonzentrat[mg];Nut.: Wacholderbeerenpulver[mg];Nut.: Rotes Weinlaubextrakt[mg];Nut.: Weißdornbeeren Trockenextrakt[mg];Nut.: Weizenkeimöl[mg];Nut.: Zitronensaftpulver[mg];Nut.: beta-Glucan[mg];Nut.: Vitamin B3 Niacin, Nicotinsäure[µg];Nut.: Vitamin A Beta-Carotin[µg];Nut.: Vitamin A Retinol[µg];Nut.: Vitamin E Alpha-Tocopherol[µg];Nut.: Lutein[µg];Nut.: Lycopin[µg];Nut.: Coenzym Q10[µg];Nut.: Zeaxanthin[µg];Nut.: Organische Säuren[mg];Nut.: Mineralstoffe[mg]
                """;

        var headerLines = TextUtils.readLines(source).stream()
            .filter(_Strings::isNotEmpty)
            .map(line->Can.ofArray(line.split(";")))
            .peek(parts->{
                assertEquals(286, parts.size());
            })
            .collect(Can.toCan());

        System.out.printf("%s%n", format(286, headerLines));
    }

    static String format(final int columnCount, final Can<Can<String>> headerLines) {

        var names = headerLines.getElseFail(0);
        var descs = headerLines.getElseFail(1);

        var sb = new StringBuilder();
        sb.append("  fields:").append("\n");

        for(int c=0; c<columnCount; ++c) {
            var name = names.getElseFail(c);
            var desc = descs.getElseFail(c);

            //System.err.printf("%s->%s%n", name, desc);

            sb.append("    ").append(name).append(":").append("\n");
            sb.append("      type: ").append("BigDecimal").append("\n");
            sb.append("      description: |").append("\n");
            sb.append("        ").append(desc).append("\n");
        }
        return sb.toString();
    }
}
